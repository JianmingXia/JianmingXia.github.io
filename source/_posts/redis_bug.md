---
title: Redis 漏洞
date: 2018/08/05 19:30:00
tags:
  - Redis
  - 漏洞
categories: Redis
---

## 说明
本周一上班后，有同事反馈说某台云主机无法连接。通过在腾讯云控制台操作，将机器启动后，发现机器的异常情况比较多，并且之前在机器上装的MySQL也不见了，但是系统日志等也没有发现异常，咨询了腾讯云的客服，也没有得到结论。最后，发现了可能是上周安装的redis导致的问题，并且留下了这个文件：
![](https://img.ryoma.top/Redis/redis_read_this.png)
<!-- more -->

查看了文中的链接：
![](https://img.ryoma.top/Redis/redis_btc.png)

## 缘由
其实在网上能发现很多关于此漏洞的说明，主要的原因是由于Redis的配置不当，导致被攻击者利用，从而实现攻击。我个人其实之前在安装时，注意过redis的配置，我在windows机器上装的是3.2.100，默认配置是只允许127.0.0.1访问；在我个人的机器上，我安装的是4.0.10，访问依然是有配置。由于即将使用的腾讯云Redis云服务是兼容Redis2.8的，所以我在测试机就安装了最稳妥的2.8.7版本，然后忽略了配置。实际上，这个版本默认是没有访问限制的，也导致了此次问题的发生。

## 预防措施
在发生了此次问题之后，我也查看相关的预防资料：

- 禁止Redis服务对公网开放——可以避免被公网扫描到，这是最稳妥的办法，做了这个操作之后，基本上可以阻拦被攻击的事件发生；

如果因为某些原因，导致必须要向公网开放，也可以做以下操作：
- 可在防火墙限定指定源ip——对访问源IP进行访问控制；
- 修改Redis默认端口——攻击一般都是通过扫描攻击，修改默认端口可以大大降低被攻击的概率；
- Redis使用普通用户权限——没有root权限，很多命令自然也就没有权限去执行了；
- 设置密码访问认证——设置复杂的密码；
- 禁用config指令——避免恶意操作；

## 资料
- https://cloud.tencent.com/developer/news/254444
- https://www.linux.org.ru/forum/talks/14052071/page1
- https://duo.com/decipher/over-18000-redis-instances-targeted-by-fake-ransomware